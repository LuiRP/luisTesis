{% extends "layouts/base.html" %}
{% load neapolitan %}
{% load mathfilters %}
{% block header %}
    Transacciones
{% endblock header %}
{% block content %}
    <div class="max-w-md mx-auto pb-24">
        {% if create_view_url %}
            <a href="{{ create_view_url }}"
               class="bg-linear-to-b from-orange-300 to-amber-200 text-neutral-700 px-4 py-3 mb-4 rounded-xl border-b-2 border-orange-300 shadow-sm text-sm font-bold flex items-center gap-2 active:translate-y-0.5 transition-all">
                <i class="bi bi-plus-lg"></i> Nuevo
            </a>
        {% endif %}
        <details class="group mb-6 bg-white border border-orange-100 rounded-xl overflow-hidden shadow-sm">
            <summary class="list-none p-3 flex justify-between items-center cursor-pointer hover:bg-orange-50 transition-colors">
                <span class="text-sm font-bold text-neutral-600"><i class="bi bi-filter-left mr-2"></i>Filtros</span>
                <i class="bi bi-chevron-down text-orange-400 group-open:rotate-180 transition-transform"></i>
            </summary>
            <form method="get" class="p-4 space-y-4 border-t border-orange-50">
                {% if filterset %}
                    {% for field in filterset.form %}
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] uppercase font-mono text-neutral-400">{{ field.label }}</label>
                            {{ field }}
                        </div>
                    {% endfor %}
                {% endif %}
                <div class="flex gap-2 pt-2">
                    <button type="submit"
                            class="flex-1 bg-orange-500 text-white py-2 rounded-lg text-sm font-bold shadow-md">
                        Aplicar
                    </button>
                    <a href="{{ request.path }}"
                       class="flex-1 bg-neutral-100 text-neutral-500 py-2 rounded-lg text-sm font-bold text-center border border-neutral-200">Limpiar</a>
                </div>
            </form>
        </details>
        {% if object_list %}
            <div class="space-y-3">
                {% for object in object_list %}
                    <a href="{% url 'transaction-detail' object.pk %}"
                       class="block bg-white border-b-2 border-orange-100 rounded-xl p-4 shadow-sm active:scale-[0.98] transition-transform">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-orange-50 flex items-center justify-center text-orange-500 border border-orange-100 flex-shrink-0">
                                    {% if object.category == 'comida' %}
                                        <i class="bi bi-egg-fried"></i>
                                    {% elif object.category == 'ocio' %}
                                        <i class="bi bi-controller"></i>
                                    {% elif object.category == 'transporte' %}
                                        <i class="bi bi-bus-front"></i>
                                    {% elif object.category == 'salud' %}
                                        <i class="bi bi-heart-pulse"></i>
                                    {% elif object.category == 'educacion' %}
                                        <i class="bi bi-book"></i>
                                    {% elif object.category == 'hogar' %}
                                        <i class="bi bi-house-door"></i>
                                    {% elif object.category == 'ropa' %}
                                        <i class="bi bi-handbag"></i>
                                    {% elif object.category == 'servicios' %}
                                        <i class="bi bi-lightning-charge"></i>
                                    {% else %}
                                        <i class="bi bi-three-dots"></i>
                                    {% endif %}
                                </div>
                                <div class="flex flex-col">
                                    <p class="text-[10px] font-mono text-neutral-400 uppercase tracking-tighter">{{ object.created_at|date:"d M, Y" }}</p>
                                    <h3 class="font-bold text-neutral-800 leading-tight">{{ object.get_category_display }}</h3>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-mono font-bold {% if object.type == 'factura' %}text-rose-500{% elif object.type == 'pago' %}text-emerald-500{% else %}text-orange-500{% endif %}">
                                    {% if object.type == 'factura' %}
                                        -
                                    {% elif object.type == 'pago' %}
                                        +
                                    {% endif %}
                                    {{ object.total_amount|abs }}
                                </p>
                            </div>
                        </div>
                        <div class="mt-3 flex items-center justify-between">
                            <div class="flex items-center gap-2 pl-12">
                                <span class="text-[10px] rounded-full px-2 py-0.5 border font-bold uppercase {% if object.type == 'factura' %} border-rose-100 text-rose-600 bg-rose-50 {% elif object.type == 'pago' %} border-emerald-100 text-emerald-600 bg-emerald-50 {% else %} border-orange-100 text-orange-600 bg-orange-50 {% endif %}">
                                    {{ object.get_type_display }}
                                </span>
                                <span class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest bg-neutral-100 px-2 py-0.5 rounded">
                                    {{ object.currency }}
                                </span>
                            </div>
                            {% if object.is_custom %}
                                <span class="text-[9px] text-amber-600 italic">
                                    <i class="bi bi-pencil-square"></i> Manual
                                </span>
                            {% endif %}
                        </div>
                    </a>
                {% empty %}
                {% endfor %}
            </div>
            {% if is_paginated %}
                <nav class="mt-8 flex flex-col items-center gap-3">
                    <span class="text-[10px] font-mono text-neutral-400 italic">PÃ¡gina {{ page_obj.number }} de {{ paginator.num_pages }}</span>
                    <div class="flex gap-2">
                        {% if page_obj.has_previous %}
                            <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}"
                               class="px-4 py-2 bg-white border border-orange-200 rounded-lg text-orange-600 text-sm font-bold">Anterior</a>
                        {% endif %}
                        {% if page_obj.has_next %}
                            <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}"
                               class="px-4 py-2 bg-white border border-orange-200 rounded-lg text-orange-600 text-sm font-bold">Siguiente</a>
                        {% endif %}
                    </div>
                </nav>
            {% endif %}
        {% else %}
            <div class="text-center py-12 bg-white rounded-xl border-2 border-dashed border-orange-100">
                <i class="bi bi-wallet2 text-orange-200 text-4xl"></i>
                <p class="text-neutral-400 text-sm mt-2">No se encontraron transacciones.</p>
            </div>
        {% endif %}
    </div>
    <style>
    /* Styling for the Django form inputs within Neapolitan filterset */
    form select, form input {
        border: 1px solid #fed7aa; /* orange-200 */
        border-radius: 0.5rem;
        padding: 0.5rem;
        font-size: 0.875rem;
        background: #fff;
    }
    form select:focus, form input:focus {
        outline: none;
        border-color: #fb923c; /* orange-400 */
        box-shadow: 0 0 0 2px rgba(251, 146, 60, 0.1);
    }
    </style>
{% endblock content %}
